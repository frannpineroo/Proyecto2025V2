@page "/chatmiembro"
@using Proyecto2025.Servicio.ServiciosHttp

@inject IHttpServicio Http

<h3>Listar Chat Miembro</h3>
<br />
<a class="btn btn-primary" target="_blank" href="/chatmiembro/crear">Crear Nuevo miembro chat</a>
<br />
<table>
    <tr>
        <th>chatmember</th>
    </tr>
    @if (registro == null)
    {
        <p>  buscando .... </p>
    }
    else if (registro.Count == 0)
    {
        <p> no hay registros cargados</p>
    }
    else
    {
        @foreach (var reg in registro)
        {
            <tr>
                <td>@reg.Id</td>
                <td>@reg.UserId</td>
                <td>@reg.ChatId</td>
                <td>@reg.IsModerator</td>
                <td>@reg.CanWrite</td>
                <td>@reg.JoinedAt</td>
                <td>
                    <a class="btn btn-primary">
                        @*  href="/chatmember/editar/{registro.Id}" *@
                        Editar
                    </a>
                </td>
                <td>
                    <button class="btn btn-danger"
                            @onclick="() => Borrar(reg)">
                        Borrar
                    </button>
                </td>

            </tr>
        }
    }

</table>
<br />
<p>@mensaje</p>

@code {
    List<ListaChatMemberDTO>? registro;
    string mensaje = "";

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        await LeerRegistros();
    }

    private async Task LeerRegistros()
    {
      
        var respuesta = await Http.Get<List<ListaChatMemberDTO>>("api/ChatMember");
        if (!respuesta.Error)
        {
            registro = respuesta.Respuesta;
        }
        else
        {
            mensaje = respuesta.ObtenerError();
        }

    }

    private async Task Borrar(ListaChatMemberDTO reg)
    {
        var respuesta = await Http.Delete($"api/ChatMember/{reg.Id}");
        if (respuesta.Error)
        {
            mensaje = respuesta.ObtenerError();
        }
        await LeerRegistros();
    }

}